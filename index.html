<script>
  fetch('/dashboard-check')
    .then(res => {
      if (!res.ok) {
        window.location.href = '/login';
      }
    })
    .catch(() => {
      window.location.href = '/login';
    });
</script>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>School Dashboard</title>
  <style>
    :root {
      --bg-color: #f5f7fb;
      --text-color: black;
      --section-bg: white;
    }
    [data-theme="dark"] {
      --bg-color: #121212;
      --text-color: #f0f0f0;
      --section-bg: #1e1e1e;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg-color); color: var(--text-color); }

    #login-page { display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #003366; color: white; flex-direction: column; }
    #login-page input, #login-page button { padding: 10px; margin: 10px; width: 250px; border: none; border-radius: 5px; }
    #login-page button { background-color: #0066cc; color: white; cursor: pointer; }

    #dashboard { display: none; }

    .navbar { display: flex; justify-content: space-between; align-items: center; background-color: #003366; padding: 1rem 2rem; color: white; }
    .logo { font-size: 1.5rem; font-weight: bold; }
    .nav-links { display: flex; list-style: none; gap: 1.5rem; }
    .nav-links li a { color: white; text-decoration: none; position: relative; }
    .nav-links li a::after { content: ""; position: absolute; bottom: -4px; left: 0; width: 0; height: 2px; background: white; transition: width 0.3s; }
    .nav-links li a:hover::after { width: 100%; }
    .hamburger { display: none; flex-direction: column; gap: 5px; cursor: pointer; }
    .hamburger span { width: 25px; height: 3px; background: white; }

    @media (max-width: 768px) {
      .nav-links { display: none; flex-direction: column; background-color: #003366; position: absolute; top: 70px; left: 0; width: 100%; text-align: center; }
      .nav-links.active { display: flex; }
      .hamburger { display: flex; }
    }

    main { padding: 2rem; }
    section { margin-bottom: 2rem; background: var(--section-bg); padding: 1.5rem; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    canvas { max-width: 100%; }
    .task-list ul { list-style: none; padding: 0; }
    .task-list li { padding: 8px 0; border-bottom: 1px solid #ccc; }
    .upload-section input[type="file"] { margin-top: 10px; }
    .upload-section button { margin-top: 10px; padding: 8px 15px; background: #0066cc; color: white; border: none; border-radius: 5px; cursor: pointer; }
    #upload-success { color: green; margin-top: 10px; display: none; }
    #uploadForm { animation: slideFade 1s ease-in-out; transition: transform 0.3s ease; }
    #uploadForm:hover { transform: scale(1.03); }
    @keyframes slideFade { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    #chat-box { height: 200px; overflow-y: auto; background: var(--bg-color); border: 1px solid #ccc; padding: 10px; border-radius: 5px; }
    #chat-input { width: calc(100% - 80px); padding: 8px; }
    #send-btn { padding: 8px 12px; background: #0066cc; color: white; border: none; border-radius: 5px; cursor: pointer; }
    #darkModeToggle { position: absolute; right: 20px; top: 20px; background: #0066cc; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; }
  </style>
</head>
<body>
  <button id="darkModeToggle">Dark Mode</button>
  <a href="/logout" style="padding: 10px; background: red; color: white; text-decoration: none; border-radius: 5px;">Logout</a>
  <div id="dashboard" style="display: block;">
    <header>
      <nav class="navbar">
        <div class="logo">üìò SchoolPanel</div>
        <ul class="nav-links" id="navLinks">
          <li><a href="#home">Home</a></li>
          <li><a href="#students">Students</a></li>
          <li><a href="#teachers">Teachers</a></li>
          <li><a href="#tasks">Upcoming Tasks</a></li>
          <li><a href="#chat">Chat Support</a></li>
          <li><a href="#logout" onclick="logout()">Logout</a></li>
        </ul>
        <div class="hamburger" id="hamburger">
          <span></span><span></span><span></span>
        </div>
      </nav>
    </header>

    <main>
      <section id="home">
        <h2>Welcome to the School Dashboard</h2>
        <p>Manage school data effectively and visually.</p>
      </section>

      <section id="students">
        <h2>Students</h2>
        <p>Enrolled students: 450</p>
      </section>

      <section id="teachers">
        <h2>Teachers</h2>
        <p>Total staff: 35</p>
      </section>

      <section id="tasks">
        <h2>Upcoming Tasks</h2>
        <div class="task-list">
          <ul>
            <li>üìö Maths Test - 14 May 2025</li>
            <li>üìù History Assignment - Due 16 May 2025</li>
            <li>üß™ Physical Science Exam - 20 May 2025</li>
          </ul>
        </div>
        <form id="uploadForm" enctype="multipart/form-data">
          <h3>Upload Your Assignment</h3>
          <input type="file" name="assignment" id="assignmentFile" required />
          <button type="submit">Upload</button>
          <p id="upload-success">‚úÖ Upload successful!</p>
        </form>
      </section>
  


      <section id="chat">
        <h2>Chat with a Tutor</h2>
        <div id="chat-box"></div>
        <input type="text" id="chat-input" placeholder="Type your message...">
        <button id="send-btn">Send</button>
      </section>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const darkModeToggle = document.getElementById('darkModeToggle');
    darkModeToggle.addEventListener('click', () => {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      document.documentElement.setAttribute('data-theme', currentTheme === 'dark' ? 'light' : 'dark');
    });

    document.getElementById('send-btn').addEventListener('click', () => {
      const input = document.getElementById('chat-input');
      const chatBox = document.getElementById('chat-box');
      if (input.value.trim()) {
        const msg = document.createElement('div');
        msg.textContent = 'üë§ You: ' + input.value;
        chatBox.appendChild(msg);
        input.value = '';
      }
    });

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("hamburger").addEventListener("click", () => {
        document.getElementById("navLinks").classList.toggle("active");
      });
    });

    document.getElementById("uploadForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const fileInput = document.getElementById("assignmentFile");
      const formData = new FormData();
      formData.append("assignment", fileInput.files[0]);

      try {
        const res = await fetch("http://localhost:3000/upload", {
          method: "POST",
          body: formData,
        });

        if (res.ok) {
          document.getElementById("upload-success").style.display = "block";
          setTimeout(() => {
            document.getElementById("upload-success").style.display = "none";
            fileInput.value = "";
          }, 3000);
        } else {
          alert("Upload failed.");
        }
      } catch (err) {
        console.error(err);
        alert("Error uploading file.");
      }
    });

    async function loadGoogleCalendar() {
      try {
        const res = await fetch('/api/calendar');
        const events = await res.json();
        console.log('Upcoming Calendar Events:', events);
      } catch (e) {
        console.error('Google Calendar API failed.', e);
      }
    }
    loadGoogleCalendar();
  </script>
  <footer style="background-color: #003366; color: white; text-align: center; padding: 1rem; margin-top: 2rem;">
    <p>Connect with us:</p>
    <div style="margin-top: 0.5rem;">
      <a href="https://facebook.com" target="_blank" style="margin: 0 10px; color: white; text-decoration: none;">Facebook</a> |
      <a href="https://twitter.com" target="_blank" style="margin: 0 10px; color: white; text-decoration: none;">Twitter</a> |
      <a href="https://instagram.com" target="_blank" style="margin: 0 10px; color: white; text-decoration: none;">Instagram</a> |
      <a href="https://linkedin.com" target="_blank" style="margin: 0 10px; color: white; text-decoration: none;">LinkedIn</a>
    </div>
    <p style="margin-top: 1rem;">&copy; 2025 SchoolPanel. All rights reserved. created by @Phenyo Dev</p>
  </footer>
</body>
</html>
